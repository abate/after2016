<template name="updateResourceForm">
  {{#autoForm meteormethod="PerformanceBackend.updateResourceForm" type="method-update"
    id="insertPerformanceResourceForm" collection="PerformanceResource" doc=this preserveForm=false resetOnSuccess=false}}
    {{> afQuickField name="performanceId" value=this.performanceId }}
    <div class="form-inline">
      {{> afQuickField name="status" }}
      {{#if afFieldValueIs name="status" value="accepted"}}
        {{> afQuickField name="area" }}
        {{> afQuickField name="timeslot" }}
      {{/if}}
      <button type="submit" class="btn btn-primary pull-right">{{_ "update"}}</button>
    </div>
    {{#if afFieldValueIs name="status" value="accepted"}}
      {{> afQuickField name="notes" }}
      <div class="form-control-static pull-right">{{_ "sign_off_by"}} {{username}}</div>
    {{/if}}
  {{/autoForm}}
</template>

<template name="performanceBackend">
  <div class="container-fluid main-container">
    <div class="row">
      <div class="col-md-3">
        {{> reactiveTable settings=PerformanceTableSettings }}
      </div>
      <div class="col-md-8 content">
        {{#if currentPerformance.title }}
          <div class="row well">
          <h1>{{currentPerformance.title}}</h1>
            {{> Template.dynamic template="updateResourceForm" data=currentResource }}
          </div>
          <div class="row">
            <div class="panel panel-default">
              <div class="panel-heading">{{_ "performance_details"}}</div>
              <div class="panel-body">
                {{> Template.dynamic template="updatePerformanceForm" data=currentPerformance }}
              </div>
            </div>
          </div>
        {{/if}}
      </div>
    </div>
  </div>
</template>
